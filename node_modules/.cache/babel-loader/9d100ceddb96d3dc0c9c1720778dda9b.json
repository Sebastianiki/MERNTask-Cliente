{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\Cursos\\\\MERN\\\\MERNTask\\\\cliente\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\Cursos\\\\MERN\\\\MERNTask\\\\cliente\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"D:\\\\Cursos\\\\MERN\\\\MERNTask\\\\cliente\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\Cursos\\\\MERN\\\\MERNTask\\\\cliente\\\\src\\\\context\\\\autenticacion\\\\authState.js\";\n\nimport React, { useReducer } from 'react';\nimport authContext from './authContext';\nimport authReducer from './authReducer';\nimport { REGISTRO_EXITOSO, REGISTRO_FALLIDO, OBTENER_USUARIO, LOGIN_EXITOSO, LOGIN_FALLIDO, CERRAR_SESION } from '../../types';\nimport clienteAxios from '../../config/axios';\nimport tokenAuth from '../../config/tokenAuth';\n\nvar AuthState = function AuthState(props) {\n  var initialState = {\n    token: localStorage.getItem('token'),\n    autenticado: null,\n    usuario: null,\n    mensaje: null,\n    cargando: true\n  };\n\n  var _useReducer = useReducer(authReducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var registrarUsuario = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(usuario) {\n      var respuesta, alerta;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return clienteAxios.post('/api/usuarios', usuario);\n\n            case 3:\n              respuesta = _context.sent;\n              console.log(respuesta.data);\n              dispatch({\n                type: REGISTRO_EXITOSO,\n                payload: respuesta.data\n              });\n              usuarioAutenticado();\n              _context.next = 13;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              //console.log(error.response.data.msg)\n              alerta = {\n                msg: _context.t0.response.data.msg,\n                categoria: 'danger'\n              };\n              dispatch({\n                type: REGISTRO_FALLIDO,\n                payload: alerta\n              });\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 9]]);\n    }));\n\n    return function registrarUsuario(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var usuarioAutenticado = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var token, respuesta, alerta;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              token = localStorage.getItem('token');\n\n              if (token) {\n                tokenAuth(token);\n              }\n\n              _context2.prev = 2;\n              _context2.next = 5;\n              return clienteAxios.get('/api/auth');\n\n            case 5:\n              respuesta = _context2.sent;\n              dispatch({\n                type: OBTENER_USUARIO,\n                payload: respuesta.data.usuario\n              });\n              _context2.next = 13;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](2);\n              alerta = {\n                msg: _context2.t0.response.data.msg,\n                categoria: 'danger'\n              };\n              dispatch({\n                type: LOGIN_FALLIDO,\n                payload: alerta\n              });\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 9]]);\n    }));\n\n    return function usuarioAutenticado() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var iniciarSesion = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(usuario) {\n      var respuesta, alerta;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return clienteAxios.post('/api/auth', usuario);\n\n            case 3:\n              respuesta = _context3.sent;\n              dispatch({\n                type: LOGIN_EXITOSO,\n                payload: respuesta.data\n              });\n              usuarioAutenticado();\n              _context3.next = 13;\n              break;\n\n            case 8:\n              _context3.prev = 8;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.log(_context3.t0.response.data.msg);\n              alerta = {\n                msg: _context3.t0.response.data.msg,\n                categoria: 'danger'\n              };\n              dispatch({\n                type: LOGIN_FALLIDO,\n                payload: alerta\n              });\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 8]]);\n    }));\n\n    return function iniciarSesion(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var cerrarSesion = function cerrarSesion(async) {\n    dispatch({\n      type: CERRAR_SESION\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(authContext.Provider, {\n    value: {\n      token: state.token,\n      autenticado: state.autenticado,\n      usuario: state.usuario,\n      mensaje: state.mensaje,\n      cargando: state.cargando,\n      registrarUsuario: registrarUsuario,\n      iniciarSesion: iniciarSesion,\n      usuarioAutenticado: usuarioAutenticado,\n      cerrarSesion: cerrarSesion\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }\n  }, props.children);\n};\n\nexport default AuthState;","map":{"version":3,"sources":["D:/Cursos/MERN/MERNTask/cliente/src/context/autenticacion/authState.js"],"names":["React","useReducer","authContext","authReducer","REGISTRO_EXITOSO","REGISTRO_FALLIDO","OBTENER_USUARIO","LOGIN_EXITOSO","LOGIN_FALLIDO","CERRAR_SESION","clienteAxios","tokenAuth","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","cargando","state","dispatch","registrarUsuario","post","respuesta","console","log","data","type","payload","usuarioAutenticado","alerta","msg","response","categoria","get","iniciarSesion","cerrarSesion","async","children"],"mappings":"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","sourcesContent":["import React, {useReducer} from 'react'\r\nimport authContext from './authContext'\r\nimport authReducer from './authReducer'\r\nimport {\r\n    REGISTRO_EXITOSO,\r\n    REGISTRO_FALLIDO,\r\n    OBTENER_USUARIO,\r\n    LOGIN_EXITOSO,\r\n    LOGIN_FALLIDO,\r\n    CERRAR_SESION\r\n} from '../../types'\r\nimport clienteAxios from '../../config/axios'\r\nimport tokenAuth from '../../config/tokenAuth'\r\nconst AuthState = props => {\r\n    const initialState = {\r\n        token: localStorage.getItem('token'),\r\n        autenticado: null,\r\n        usuario: null,\r\n        mensaje: null,\r\n        cargando: true\r\n    }\r\n\r\n    const [state, dispatch] = useReducer(authReducer, initialState)\r\n\r\n    const registrarUsuario = async usuario =>{\r\n        try{\r\n            const respuesta = await clienteAxios.post('/api/usuarios', usuario)\r\n            console.log(respuesta.data)\r\n            dispatch({\r\n                type: REGISTRO_EXITOSO,\r\n                payload: respuesta.data\r\n            })\r\n            usuarioAutenticado()\r\n        }catch(error){\r\n            //console.log(error.response.data.msg)\r\n            const alerta = {\r\n                msg: error.response.data.msg,\r\n                categoria: 'danger'\r\n            }\r\n            dispatch({\r\n                type: REGISTRO_FALLIDO,\r\n                payload: alerta\r\n            })\r\n        }\r\n    }\r\n\r\n    const usuarioAutenticado = async () =>{\r\n        const token = localStorage.getItem('token')\r\n        if(token){\r\n            tokenAuth(token)\r\n        }\r\n        try{\r\n            const respuesta = await clienteAxios.get('/api/auth')\r\n            dispatch({\r\n                type: OBTENER_USUARIO,\r\n                payload: respuesta.data.usuario\r\n            })\r\n            \r\n        }catch(error){\r\n            const alerta = {\r\n                msg: error.response.data.msg,\r\n                categoria: 'danger'\r\n            }\r\n            dispatch({\r\n                type: LOGIN_FALLIDO,\r\n                payload: alerta\r\n            })\r\n        }\r\n    }\r\n\r\n    const iniciarSesion = async usuario =>{\r\n        try{\r\n            const respuesta = await clienteAxios.post('/api/auth', usuario)\r\n            dispatch({\r\n                type: LOGIN_EXITOSO,\r\n                payload: respuesta.data\r\n            })\r\n            usuarioAutenticado()\r\n        }catch(error){\r\n            console.log(error.response.data.msg)\r\n            const alerta = {\r\n                msg: error.response.data.msg,\r\n                categoria: 'danger'\r\n            }\r\n            dispatch({\r\n                type: LOGIN_FALLIDO,\r\n                payload: alerta\r\n            })\r\n        }\r\n    }\r\n\r\n    const cerrarSesion = async =>{\r\n        dispatch({\r\n            type: CERRAR_SESION\r\n        })\r\n    } \r\n    return(\r\n        <authContext.Provider\r\n            value={{\r\n                token: state.token,\r\n                autenticado: state.autenticado,\r\n                usuario: state.usuario,\r\n                mensaje: state.mensaje,\r\n                cargando: state.cargando,\r\n                registrarUsuario,\r\n                iniciarSesion,\r\n                usuarioAutenticado,\r\n                cerrarSesion\r\n            }}\r\n        >\r\n            {props.children}\r\n        </authContext.Provider>\r\n    )\r\n}\r\n\r\nexport default AuthState"]},"metadata":{},"sourceType":"module"}